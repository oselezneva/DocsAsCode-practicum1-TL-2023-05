= Паспорт микросервиса _TBD_
:toc:
// остальные атрибуты в этом заголовке - это кастомные переменные, которые будут использоваться дальше в ТЗ
:jira_url: https://dit.example.ru/jira/browse
// src_path - относительный путь, по которому расположены другие документы, которые далее будут включаться в ТЗ, схема plantuml, примеры запросов и ответов бэковых интерфейсов и т.д.
:src_path: .
// yaml_file - имя файла с контрактом МкС в каталоге src_path
:yaml_file: service-api.yaml
:yaml_url: https://git-lab.example.ru/integration/TBD_
//common_errors_url - адрес страницы в Confluence с возможных кодов ошибок. Используется далее в описании исключительных сценариев
:common_errors_url: https://dit.example.ru/confluence/pages/viewpage.action?pageId=60260111
// adlayer-111_url - адрес страницы с adlayer-111
:adlayer-111_url: https://dit.example.ru/confluence/pages/viewpage.action?pageId=52396111
// adlayer_url - адрес страницы с adlayer
:adlayer_url: https://dit.example.ru/confluence/pages/viewpage.action?pageId=52986111

.История изменений
|===
|Версия документа|Версия микросервиса|Дата|Описание| Релиз зименения | Версия контракта | Задачи в Jira | Автор

| | | | | | | |
|===

== Общие сведения
.Общие сведения о микросервисе
[cols="1a,1a", options="header"]
|===
|Параметр |Описание
|Техническое название сервиса	| 
|Назначение сервиса	| 
|Используется системами	| 
|Использует системы	| 
|Протокол передачи данных	| 
|Тип сервиса	|  
|Кодировка	| 
|Статус	| 
* [ ] В разработке
* [ ] На среде TEST
* [ ] На среде PREPROD
* [ ] На среде PROD
* [ ] Не используется
|===

== Контракт 
link:{src_path}/{yaml_file}[{yaml_file}]

== Назначение 
МкС предназначен для выполнения следующих функций:

*     + 
*      +
*      +
*      +

== Архитектура работы сервиса

_TBD_


== Детальное описание методов сервиса
== SM_01. _Название операции метода латиницей_ +
*Название метода*:  Название операции метода латиницей +
*Путь метода*: /путь для вызова (исключая host, например, _/account_) +
*Тип взаимодействия*: _синхронный/асинхронный_ +
*Тип операции*: POST/PUT/PATCH/GET/DELETE +
*Тип входящего сообщения*: http запрос, Content-Type: application/json +
*Тип исходящего сообщения*: http ответ, Content-Type: application/json +
*Влияние на группы продуктов*: не применимо +
*Описание очередей MQ*: не применимо +
*Бизнес-объект*: наименование БО сервиса (если сервис работает с БО). Например: _*Заявка*_ +


=== Краткое описание метода

_TBD_

=== Диаграмма работы метода
image::{artifacts_path}/SM_01.puml[]

=== Алгоритм работы метода
. *Формирование и отправка запроса*
.. Потребитель Мкс формирует запрос к микросервису и вызывает метод проверки возможности выполнения внутреннего перевода.
.. Выполняется проверка параметров запроса на соответствие link:{src_path}/{yaml_file}[контракту микросервиса]
... Если проверка неуспешна, то выполняется исключительный сценарий {common_errors_url}[EC-Validation], основной сценарий завершается.

. *Выполнение операции _TBD_ в бэке*
.. Подготовавливаем запрос. Используется преобразование link:#bookmark-SM_01_T_01_01[SM_01. T_01_01].
.. Вызываем метод _TBD_

. *Обработка результа операции*
.. Обрабатывается полученный ответ от _TBD_
- Если при вызове хранимой процедуры произошла ошибка или retCode != 0, то завершаем выполнение сценария с HTTP code = 500 ({common_errors_url}[EC-Exception]). Обработка основного сценария прекращается.



== SM_02. _Название операции метода латиницей_ 
*Название метода*:  Название операции метода латиницей +
*Путь метода*: /путь для вызова (исключая host, например, _/account_) +
*Тип взаимодействия*: _синхронный/асинхронный_ +
*Тип операции*: POST/PUT/PATCH/GET/DELETE +
*Тип входящего сообщения*: http запрос, Content-Type: application/json +
*Тип исходящего сообщения*: http ответ, Content-Type: application/json +
*Влияние на группы продуктов*: не применимо +
*Описание очередей MQ*: не применимо +
*Бизнес-объект*: наименование БО сервиса (если сервис работает с БО). Например: _*Заявка*_ +

=== Краткое описание метода

_TBD_

=== Диаграмма работы метода
image::{artifacts_path}/SM_02.puml[]

=== Алгоритм работы метода
. *Формирование и отправка запроса*
.. Потребитель Мкс формирует запрос к микросервису и вызывает метод проверки возможности выполнения внутреннего перевода.
.. Выполняется проверка параметров запроса на соответствие link:{src_path}/{yaml_file}[контракту микросервиса]
... Если проверка неуспешна, то выполняется исключительный сценарий {common_errors_url}[EC-Validation], основной сценарий завершается.

. *Выполнение операции _TBD_ в бэке*
.. Подготовавливаем запрос. Используется преобразование link:#bookmark-SM_02_T_02_01[SM_02. T_02_01].
.. Вызываем метод _TBD_

. *Обработка результа операции*
.. Обрабатывается полученный ответ от _TBD_
- Если при вызове хранимой процедуры произошла ошибка или retCode != 0, то завершаем выполнение сценария с HTTP code = 500 ({common_errors_url}[EC-Exception]). Обработка основного сценария прекращается.

== SM_03. _Название операции метода латиницей_
*Название метода*:  Название операции метода латиницей +
*Путь метода*: /путь для вызова (исключая host, например, _/account_) +
*Тип взаимодействия*: _синхронный/асинхронный_ +
*Тип операции*: POST/PUT/PATCH/GET/DELETE +
*Тип входящего сообщения*: http запрос, Content-Type: application/json +
*Тип исходящего сообщения*: http ответ, Content-Type: application/json +
*Влияние на группы продуктов*: не применимо +
*Описание очередей MQ*: не применимо +
*Бизнес-объект*: наименование БО сервиса (если сервис работает с БО). Например: _*Заявка*_ +

=== Краткое описание метода

_TBD_

=== Диаграмма работы метода
image::./annex/diagrams/SM03.puml[]
(См _annex/diagrams/SM03.puml_ в боковой панели).

=== Алгоритм работы метод

_TBD_

== Конфигурационные параметры
[[config-params]]
|===
h|Название	h|Тип значения h|Значение по умолчанию	h|Контакты поддержки h|Комментарий

| | | | |
| | | | |
|===
 

== Преобразование данных
=== [[bookmark-T_01_01]] SM_01. T_01_01 - Правило формирования запроса к процедуре _TBD_ на стороне _TBD_
[[T_01_01]]
|===
.2+<h|Наименование поля 3.+<h|Источник    +
запрос к мкс _TBD_ .2+<h|Преобразование 3.+<h|Получатель   + 
Запрос к методу _TBD_   +
на стороне _TBD_ .2+<h|Комментарий
h|Атрибут h|Тип поля h|Обязательность h|Атрибут h|Тип поля h|Обязательность 

| |  |  |  | | | | |  
|  | |  |  | | | | |  
|  |  |  |   | | |  | |  
|  |  |  | | | |  | |  

|===


== Нефункциональные требования
=== Протоколирование работы
. Результаты работы сервиса должны логироваться.
.. Способ логирования: {adlayer-105_url}[стандартный механизм]

=== Производительность
|===
h|Параметр	h|Значение

|Максимальное количество запросов в день	| 
|Пиковая нагрузка| 
|Максимальное время отклика	|
|===

=== Доступность
. Время доступности: 24x7*365

=== Класс восстановления
|===
|Класс критичности	|Класс восстановления |RTO |RPO

| | | |
|===

=== Политики обеспечения безопасности и целостности
Нет

=== Аутентификация и авторизация
. Необходимо использовать аутентификацию системы X.

=== Защищаемые объекты
. Размещение во внутреннем контуре.



== Приложение
=== Примеры вызова хранимых процедур на стороне _TBD_
==== Пример вызова хранимой процедуры _TBD_ для изменения статуса счета
.Пример запроса на изменение статуса счета
[source,xml]
----
<?xml version="1.0" encoding="WINDOWS-1251"?>
<command name="ChangeContractStatus" direction="Inbound">
<timestamp>2021-12-07 14:47:28.134</timestamp>
<entity type="DEP">
  <field name="contract">11111111111</field>
  <field name="transitionName">Закрытие</field>
  <field name="operID">TST_DFS_MRK</field>
</entity>
</command>
----
.Пример ответа _TBD_ на запрос на изменение статуса счета
[source,xml]
----
<?xml version="1.0" encoding="windows-1251" ?>
<command name="ChangeContractStatus" direction="Inbound">
<timestamp>2021-12-07 14:47:28.134</timestamp>
<entity type="DEP">
  <field name="contract">11111111111</field>
  <field name="transitionName">Закрытие</field>
  <field name="operID">TST_DFS_MRK</field>
</entity>
  <status>
    <retCode>0</retCode>
  </status>
</command>
----



=== Документация по взаимодействию _TBD_

Описание и примеры вызова хранимых процедур на стороне _TBD_ можно найтив документации, приложенной к задаче https://dit.example.ru/jira/browse/TBD
